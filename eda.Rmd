---
title: "Exploratory Data Analysis"
author: "Ethan Schubert"
date: "2025-11-16"
output: html_document
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
```

### Load Data
In this notebook, I examine the megawatt and temperature data to examine possible trends with power load. Zone PE is used most commonly as a case study, but the trends observed for PE appear to hold for most other zones as well.
```{r}
load("data/processed/metered_clean.RData")
load("data/processed/open_meteo_historical_temp.RData")
```

### MW Averages
First, I examine how much the average load on each zone changes from year to year. For most zones, the average load across the year appears to remain constant, however, there are a few noteable exceptions, especially DOM.
```{r}
metered_clean %>% group_by(year_ept, load_area) %>% 
  summarize(mw = mean(mw)) %>% 
  ggplot(aes(x = year_ept, y = mw, color=load_area)) +
  geom_point() +
  geom_line() +
  labs(title = 'Average MW by Year and Zone', x = 'Year', y = 'MW')
```

### Daily cycle
Power consumption likely follows a daily cycle, since power should be used most during waking hours. Below is a plot of the power load on PE from November 9th to 16th, 2024. The daily cycle appears to be bimodal, with modes in the morning and afternoon/evening. It seems that the later peak tends to be taller than the earlier peak, but this does not hold for the 15th.
```{r}
metered_clean %>% 
  filter(load_area == "PE", between(date_ept, as.Date('2024-11-09'), as.Date('2024-11-16'))) %>% 
  ggplot(aes(x = hourofyear_ept, y = mw)) +
  geom_line() +
  labs(title = 'MW for PE 2024-11-09 to 2024-11-16', x = 'Hour of year', y = 'MW')
```

### Annual cycle
There is also an annual cycle for power consumption, with higher load in the middle and ends of the year, likely corresponding to summer and winter increases for cooling/heating.
```{r}
metered_clean %>% 
  filter(load_area == "PE") %>%
  ggplot(aes(x = hourofyear_ept, y = mw)) +
  geom_line() +
  facet_wrap(~factor(year_ept)) +
  labs(title = 'MW for PE from 2021-2025', x = 'Hour of year', y = 'MW')
```

This trend also appears to be present in other zones as well.
```{r}
metered_clean %>% 
  filter(load_area == "EASTON") %>%
  ggplot(aes(x = hourofyear_ept, y = mw)) +
  geom_line() +
  facet_wrap(~factor(year_ept)) +
  labs(title = 'MW for EASTON from 2021-2025', x = 'Hour of year', y = 'MW')
```

### Temperature data
Due to the seasonality in the load data, I would expect the trend to follow the temperature in some way. Plotting the daily megawatts alongside average temperature there appears to be a (noisy) nonlinear relationship between the two, with low load for temperatures between 40 and 60 and high power consumption elsewhere, especially in high temperatures.
```{r}
metered_clean %>% filter(load_area == "PE", year_ept == 2024) %>% 
  left_join(filter(forecast_temp, location_id==9), by = join_by(date_ept, hour24_ept)) %>% 
  group_by(dayofyear_ept, date_ept) %>% 
  summarize(mw = mean(mw), temp_F = mean(temp_F)) %>% 
  ggplot(aes(x = dayofyear_ept, y = temp_F)) +
  geom_line() +
  scale_y_continuous(name = 'Mean Temperature (F)', 
                     sec.axis = sec_axis(~(.+50)*45, name='Mean Megawatts')) +
  geom_line(aes(y = mw/45-50), color='orange', alpha=0.5) +
  labs(title="Mean Daily Temperature in PA with PE MW", x="Day of Year in 2024")
```

```{r}
metered_clean %>% filter(load_area == "PE", year_ept == 2024) %>% 
  left_join(filter(forecast_temp, location_id==9), by = join_by(date_ept, hour24_ept)) %>% 
  group_by(dayofyear_ept, date_ept) %>% 
  summarize(mw = mean(mw), temp_F = mean(temp_F)) %>% 
  ggplot(aes(y = mw, x = temp_F)) +
  geom_line() +
  labs(x="Mean Daily Temperature", 
       title="Mean Daily Temperature to Power Consumption in PE", y="Mean MW")
```

### Peak hours
The peak hour of the day appears to be in the late afternoon or early evening, with occasional peaks in the morning. This agrees with the daily trend observed earlier, but this overlap may be difficult to identify with modeling.
```{r}
metered_clean %>% filter(load_area == "PE", year_ept == 2024) %>% 
  group_by(date_ept, weekday_ept, dayofyear_ept) %>%
  arrange(hour24_ept, .by_group = T) %>% 
  summarize(peakhour = which.max(mw)-1) %>% 
  ggplot(aes(x = dayofyear_ept, y = peakhour)) +
  geom_point() + 
  labs(title = "Peak hours for PE over time", x = 'Day of year in 2024', y='Peak hour')
```

### Peak days
The peak days appear to be most common in the middle of the week, between Tuesday through Thursday. However, this does not appear to follow a temperature trend and may be due to other factors.
```{r}
metered_clean %>% filter(load_area == "PE", year_ept == 2024) %>% 
  group_by(weekday_ept) %>% 
  summarize(n_peakdays = sum(is_peak_day_in_week))
```

```{r}
metered_clean %>% filter(load_area == "PE", year_ept == 2024) %>% 
  left_join(filter(forecast_temp, location_id==9), by = join_by(date_ept, hour24_ept)) %>% 
  filter(is_peak_day_in_week == 1) %>% 
  mutate(weekday_ept = factor(weekday_ept, 
    levels=c('Sunday', 'Saturday', 'Friday', 'Thursday', 'Wednesday', 'Tuesday', 'Monday'))) %>% 
  group_by(dayofyear_ept, weekday_ept, date_ept) %>% 
  summarize(mw = mean(mw), temp_F = mean(temp_F)) %>% 
  ggplot(aes(y = weekday_ept, x = temp_F)) +
  geom_point() +
  labs(x="Mean Daily Temperature", 
       title="Peak Days by Temperature", y="Day of week")
```

